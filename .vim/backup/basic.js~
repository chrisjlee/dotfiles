$(document).ready(function() {

	$('.logout').click(function() {

	       $.post('index.php', { action: 'close' }, function (data) {
               		location.reload();
	       });

	       return false;

	});

	$('.restricted_area').click(function() {
		$('.restricted_login_form').dialog('open');
		return false;
	});
		
	$('.restricted_login_form').dialog({

		autoOpen: false,
		modal: true,
		width: 500,
		title: "Use the form below to login",
		buttons: {
			"Login": function() {
				var email = $('#restricted_email').val();
				var password = $('#restricted_password').val();
				var dialog = $(this);

				$.post('index.php', {
					action: 'restricted',
					email: email,
					password: password,
				}, function(data) {
					data = $.parseJSON(data);

					if (data['validade'] == 'true') {
						window.location = '?action=page&page=accounts';
					}
					else {
						$('.restricted.error').remove();
						$('.restricted_login_form').append('<div class="restricted error"></div>');

						$.each(data['error'], function(index, value) {
							$('.error').append('<p><strong>Error #'+(index + 1)+':</strong> '+value+'</p>');
						});
					}
				});
			},
			Cancel: function() {
				$(this).dialog("close");
			}
		},
		close: function() {
		       $.remove('.error');
		}

	});

});
